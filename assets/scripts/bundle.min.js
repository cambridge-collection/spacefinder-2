function storageAvailable(e){if(!spacefinder.canUseLocalStorage())return!1;try{var t=window[e],n="__storage_test__";return t.setItem(n,n),t.removeItem(n),!0}catch(e){return e instanceof DOMException&&(22===e.code||1014===e.code||"QuotaExceededError"===e.name||"NS_ERROR_DOM_QUOTA_REACHED"===e.name)&&t&&0!==t.length}}function setWithExpiry(e,t,n){t={value:t,expiry:(new Date).getTime()+60*n*60*1e3};localStorage.setItem(e,JSON.stringify(t))}function getWithExpiry(e){var t=localStorage.getItem(e);return t?(t=JSON.parse(t),(new Date).getTime()>t.expiry?(localStorage.removeItem(e),null):t.value):null}function haversine_distance(e,t){var n=e.lat*(Math.PI/180),a=t.lat*(Math.PI/180),s=a-n,t=(t.lng-e.lng)*(Math.PI/180),e=12742142*Math.asin(Math.sqrt(Math.sin(s/2)*Math.sin(s/2)+Math.cos(n)*Math.cos(a)*Math.sin(t/2)*Math.sin(t/2)));return Math.round(e)}function getJSON(t){var e;t.hasOwnProperty("key")&&t.hasOwnProperty("url")&&(t.hasOwnProperty("expires")||(t.expires=.25),storageAvailable("localStorage")&&getWithExpiry(t.key)?(splog("getting data '"+t.key+"' from local storage","utilities.js"),t.hasOwnProperty("callback")&&"function"==typeof t.callback&&t.callback(JSON.parse(getWithExpiry(t.key)))):(splog("getting data '"+t.key+"' from "+t.url,"utilities.js"),(e=new XMLHttpRequest).addEventListener("load",function(){var e;storageAvailable("localStorage")&&(e=(new Date).getTime()+60*t.expires*60*1e3,splog("storing data '"+t.key+"' in localstorage - expires "+e,"utilities.js"),setWithExpiry(t.key,this.responseText,t.expires)),t.hasOwnProperty("callback")&&"function"==typeof t.callback&&t.callback(JSON.parse(this.responseText))}),e.open("GET",t.url),e.send()))}function getSpaceById(t){for(let e=0;e<spacefinder.spaces.length;e++)if(spacefinder.spaces[e].id==t)return spacefinder.spaces[e]}function getFilterData(e,n){for(let t=0;t<spacefinder.filters.length;t++)if(spacefinder.filters[t].key==e){if(void 0===n)return spacefinder.filters[t];for(let e=0;e<spacefinder.filters[t].options.length;e++)if(spacefinder.filters[t].options[e].key==n)return spacefinder.filters[t].options[e]}return!1}function getSpaceBySlug(t){for(let e=0;e<spacefinder.spaces.length;e++)if(spacefinder.spaces[e].slug==t)return spacefinder.spaces[e]}function getSpaceNodeById(e){return document.querySelector('[data-id="'+e+'"]')}function setElementFocus(e){splog("Setting element focus on #"+e,"utilities.js"),null!==document.getElementById(e)&&(document.getElementById(e).setAttribute("tabindex","-1"),document.getElementById(e).focus())}function togglePanel(e,t){var n;-1!==["filters","list","map"].indexOf(e)&&(n=t?"active":"inactive",t=t?"inactive":"active",document.querySelector('#top-bar .navbutton[data-view="'+e+'"]').classList.remove(t),document.querySelector('#top-bar .navbutton[data-view="'+e+'"]').classList.add(n),document.getElementById(e).classList.remove(t),document.getElementById(e).classList.add(n))}function setHash(e){""===e&&"pushState"in history?history.pushState("",document.title,window.location.pathname):window.location.hash=e}function splog(e,t){var n;spacefinder.debug&&(n=new Date,console.log(n.getHours()+":"+n.getMinutes().toString().padStart(2,"0")+":"+n.getSeconds().toString().padStart(2,"0")+"."+n.getMilliseconds().toString().padStart(3,"0")+" "+t.padEnd(12)+" - "+e))}function setupLayout(){document.querySelectorAll("#top-bar .navbutton").forEach(t=>{t.addEventListener("click",e=>{e.preventDefault(),document.getElementById("top-bar").dispatchEvent(new CustomEvent("viewchange",{bubbles:!0,cancelable:!0,composed:!1,detail:{view:t.getAttribute("data-view")}}))})}),document.addEventListener("viewchange",e=>{document.getElementById(e.detail.view);"filters"==e.detail.view&&document.querySelector('#top-bar .navbutton[data-view="filters"]').classList.contains("active")?(togglePanel("filters",!1),togglePanel("list",!0)):(["filters","list","map"].forEach(e=>{togglePanel(e,!1)}),togglePanel(e.detail.view,!0),"filters"==e.detail.view&&window.setTimeout(function(){document.getElementById("search-input").focus()},1e3))})}function setView(){spacefinder.mapReady&&spacefinder.spacesLoaded&&spacefinder.filtersLoaded&&(splog("Setting view","layout.js"),window.innerWidth>=spacefinder.breakpoints.large?(splog("Showing filters panel","layout.js"),togglePanel("filters",!0)):(splog("Hiding filters panel","layout.js"),togglePanel("filters",!1)),window.innerWidth>=spacefinder.breakpoints.small)&&(splog("Showing list panel","layout.js"),togglePanel("list",!0))}function getFilterStatus(){splog("getFilterStatus","filters.js");var n=[];for(const o of document.querySelectorAll("#filters input[type=checkbox]"))if(o.checked){var a=o.getAttribute("data-filterkey"),s=o.getAttribute("data-optionkey");let t=!1;if(n.length)for(let e=0;e<n.length;e++)n[e].name==a&&-1==n[e].value.indexOf(s)&&(n[e].value.push(s),t=!0);t||n.push({name:a,value:[s]})}var e=document.getElementById("search-input").value.trim();return 1<e.length&&n.push({name:"search",value:e.split(" ")}),n}function loadFilters(){splog("loadFilters","filters.js"),getJSON({key:"filters",url:spacefinder.filtersurl,callback:e=>{e.length&&(spacefinder.filters=e,spacefinder.filtersLoaded=!0,document.dispatchEvent(new Event("filtersloaded")))}})}function renderFilters(){if(splog("renderFilters","filters.js"),spacefinder.filters.length){var e=document.createElement("form"),t=(e.setAttribute("id","filter-options-form"),e.setAttribute("role","search"),e.setAttribute("aria-label","Search and filter spaces"),document.createElement("div"));t.classList.add("top-controls"),t.innerHTML='<div><label for="search-input" class="visuallyhidden">Search University spaces</label><input id="search-input" type="search" placeholder="Search"></div><div class="searchbuttons"><button type="reset" id="search-reset" class="btn" disabled>Reset<span class="visuallyhidden"> University spaces search and filters</span></button><button type="submit" id="search-submit" class="btn" aria-controls="searchResultsSummary" disabled>Search<span class="visuallyhidden"> University spaces</span></button></div></div>',e.appendChild(t);let i=document.createElement("div");i.classList.add("panel-content"),spacefinder.filters.forEach(n=>{var e=document.createElement("fieldset"),t=(e.classList.add("filter-options"),e.classList.add(n.key+"-filter-options"),document.createElement("legend")),a=document.createElement("ul");a.setAttribute("id","filters-"+n.key),1===n.options.length?(t.classList.add("visuallyhidden"),t.appendChild(document.createTextNode(n.label))):(e.classList.add("accordion"),t.innerHTML='<button type="button" class="accordion-trigger" id="trigger-'+n.key+'" aria-controls="filters-'+n.key+'" aria-expanded="'+(n.open?"true":"false")+'" tabindex="0"><span>'+n.label+"</span></button>",a.classList.add("accordion-content"),a.setAttribute("aria-hidden",n.open?"false":"true"),a.setAttribute("aria-labelledby","trigger-"+n.key),n.open||a.setAttribute("hidden","")),e.appendChild(t);let s="",o=n.exclusive?' class="exclusive"':"";n.options.forEach(e=>{s=(s+='<li class="filter-option '+n.key+" "+n.key+"_"+e.key+'" data-id="'+n.key+"_"+e.key+'">')+'<input type="checkbox" data-filterkey="'+n.key+'" data-optionkey="'+e.key+'" id="'+n.key+"_"+e.key+'" name="'+n.key+"_"+e.key+'" value="'+n.key+"_"+e.key+'"'+o+">";var t=e.icon||"icon-tick";s=s+('<span class="'+t+'"></span><label for="'+n.key+"_"+e.key+'">'+e.label)+"</label></li>"}),a.innerHTML=s,e.appendChild(a),i.appendChild(e)}),e.appendChild(i),document.getElementById("filters").appendChild(e),document.dispatchEvent(new Event("filtersrendered"))}}function setupFilters(){splog("setupFilters","filters.js"),document.addEventListener("filtersapplied",e=>{getFilterStatus().length?(document.getElementById("search-reset").removeAttribute("disabled"),document.getElementById("search-submit").removeAttribute("disabled")):document.getElementById("search-input").value.trim().length<2&&(document.getElementById("search-reset").setAttribute("disabled",""),document.getElementById("search-submit").setAttribute("disabled",""))});for(const e of document.querySelectorAll("#filters input[type=checkbox]"))e.addEventListener("focus",e=>{e.target.closest("li").classList.add("focus"),e.target.closest("li").scrollIntoView(!1)}),e.addEventListener("blur",e=>{document.querySelectorAll("#filters li").forEach(e=>e.classList.remove("focus"))}),e.addEventListener("change",e=>{e=e.target;if(e.matches(".exclusive")){var t=e.checked;for(const n of e.closest("ul").querySelectorAll("input[type=checkbox].exclusive"))n.checked=!1;e.checked=t}e.dispatchEvent(new Event("viewfilter",{bubbles:!0}))});document.getElementById("search-reset").addEventListener("click",e=>{e.preventDefault(),document.getElementById("filter-options-form").reset();for(const t of document.querySelectorAll("#filters input[type=checkbox]"))t.checked=!1;e.target.dispatchEvent(new Event("viewfilter",{bubbles:!0}))}),document.getElementById("search-input").addEventListener("input",e=>{var t=document.getElementById("search-input").value.trim();1<t.length?(document.getElementById("search-reset").removeAttribute("disabled"),document.getElementById("search-submit").removeAttribute("disabled")):(null==document.querySelectorAll("#filters input[type=checkbox]:checked")&&(document.getElementById("search-reset").setAttribute("disabled",""),document.getElementById("search-submit").setAttribute("disabled","")),0==t.length&&e.target.dispatchEvent(new Event("viewfilter",{bubbles:!0})))}),document.getElementById("search-submit").addEventListener("click",e=>{e.preventDefault();var t=document.getElementById("search-input").value.replace(/[^a-zA-Z0-9 ]/g,"").trim();splog(t,"filters.js"),1<t.length&&(document.getElementById("search-input").value=t,e.target.dispatchEvent(new Event("viewfilter",{bubbles:!0})),document.dispatchEvent(new CustomEvent("sfanalytics",{detail:{type:"search",terms:t}}))),window.innerWidth<spacefinder.breakpoints.large&&document.getElementById("top-bar").dispatchEvent(new CustomEvent("viewchange",{bubbles:!0,cancelable:!0,composed:!1,detail:{view:"list"}}))}),document.querySelectorAll(".accordion").forEach(e=>{new Accordion(e)})}function applyFilters(){splog("applyFilters","spaces.js");const e=getFilterStatus();document.getElementById("listcontainer").scrollTop=0;e.length?(e.forEach(e=>{"search"!==e.name&&document.dispatchEvent(new CustomEvent("sfanalytics",{detail:{type:"filter",filtername:e.name,terms:e.value.join(", ")}}))}),document.querySelectorAll(".list-space").forEach(a=>{a.classList.remove("hidden");let s=!0;e.forEach(n=>{if("search"==n.name)n.value.every(e=>{return new RegExp("\\b"+e.toLowerCase()+"\\b").test(a.textContent.toLowerCase())})||(s=!1);else if("open"==n.name)"open"!=a.getAttribute("data-openclass")&&(s=!1);else if(getFilterData(n.name).additive){let t=!1;n.value.forEach(e=>{a.classList.contains(n.name+"_"+e)||(t=!0)}),!0===t&&(s=!1)}else{var e=n.name+"_("+n.value.join("|")+")";a.className.match(e)||(s=!1)}}),s||a.classList.add("hidden")})):document.querySelectorAll(".list-space").forEach(e=>{e.classList.remove("hidden")}),document.dispatchEvent(new CustomEvent("spaceDeselected",{bubbles:!0,detail:!1})),document.dispatchEvent(new Event("filtersapplied"))}function updateListFilterMessage(){splog("updateListFilterMessage","spaces.js");var e=getFilterStatus(),t=document.getElementById("listfilters");t.textContent="",t.setAttribute("hidden","");let n=filtermessage=resultsmessage="";e.length&&e.forEach(a=>{if("search"==a.name){a.value.length;n="<p>Searching spaces which contain text: ";let t=[];a.value.forEach(e=>{t.push('<button class="search-term icon-remove" data-searchtext="'+e+'">'+e+"</button>")}),n+=t.join(" or ")+"</p>"}else{var e=getFilterData(a.name);if(1===e.options.length)filtermessage+='<p><button class="filter-term icon-remove" data-termid="'+a.name+"_"+a.value+'">'+e.message+"</button>";else{filtermessage+="<p>"+e.message;let n=[];a.value.forEach(e=>{var t=getFilterData(a.name,e);t&&n.push('<button class="filter-term icon-remove" data-termid="'+a.name+"_"+e+'">'+t.label+"</button>")}),filtermessage+=n.join(e.additive?" and ":" or ")+"</p>"}}});e=document.querySelectorAll(".list-space").length;let a=e;null!=document.querySelectorAll(".list-space.hidden")&&0==(a-=document.querySelectorAll(".list-space.hidden").length)&&(resultsmessage='<p class="noresults">Sorry, your search has found no results - try removing some of your search criteria.</p>'),n+filtermessage+resultsmessage!=""&&(t.innerHTML=n+filtermessage+resultsmessage,t.removeAttribute("hidden")),document.getElementById("searchResultsSummary").textContent="Showing "+a+" of "+e+" spaces"}function selectSpace(e,t){splog("selectSpace","spaces.js");var n=getSpaceById(e),t=(setHash("/space/"+n.slug),document.dispatchEvent(new CustomEvent("sfanalytics",{detail:{type:"select",id:e,name:n.title,src:t}})),renderAdditionalInfo(n.id),document.querySelector('[data-id="'+e+'"]')),n=(document.querySelectorAll(".list-space").forEach(e=>{e.classList.remove("active")}),t.classList.add("active"),t.querySelector("button.space-title").setAttribute("aria-expanded",!0),document.getElementById("listcontainer")),e=document.getElementById("listcontent"),a=document.getElementById("listfilters"),t=t.offsetTop+a.offsetHeight-e.offsetTop;n.scrollTop=t}function deselectSpaces(e){splog("deselectSpaces","spaces.js"),document.querySelector(".list-space.active")&&(document.querySelectorAll(".additionalInfo").forEach(e=>{e.textContent=""}),document.querySelectorAll(".list-space").forEach(e=>{e.classList.remove("active")}),document.querySelectorAll("button.space-title").forEach(e=>{e.setAttribute("aria-expanded",!1)}),document.querySelector('.space-title[data-spaceid="'+parseInt(e)+'"]')),setHash("")}function activateSort(e,t){splog("activateSort - sorting spaces by "+t+" "+(e?"activated":"deactivated"),"spaces.js");var n=document.getElementById("sort"+t);e?(n.disabled=!1,n.addEventListener("click",sortSpacesListener)):(n.disabled=!0,n.removeEventListener("click",sortSpacesListener),"distance"===t&&(n.setAttribute("title","Sort by distance (nearest to farthest)"),n.setAttribute("aria-label","Sort by distance (nearest to farthest)")))}function sortSpacesListener(e){splog("sortSpacesListener","spaces.js"),e.preventDefault();var t,n,a,s=e.target.getAttribute("data-sortdir"),o=e.target.getAttribute("id"),s="desc"==s||""==s;"sortalpha"===o?(t=s?"icon-sort-name-down":"icon-sort-name-up",a=s?"icon-sort-name-up":"icon-sort-name-down",e.target.setAttribute("title",n=s?"Sort alphabetically (descending, z to a)":"Sort alphabetically (ascending, a to z)"),e.target.setAttribute("aria-label",n),e.target.classList.remove(a),e.target.classList.add(t)):"sortdistance"===o&&(e.target.setAttribute("title",n=s?"Sort by distance (farthest to nearest)":"Sort by distance (nearest to farthest)"),e.target.setAttribute("aria-label",n),(a=document.getElementById("sortalpha")).setAttribute("title","Sort alphabetically (ascending, a to z)"),a.setAttribute("aria-label","Sort alphabetically (ascending, a to z)"),a.classList.remove("icon-sort-name-down"),a.classList.add("icon-sort-name-up"),a.setAttribute("data-sortdir","desc")),sortSpaces(o,s)}function sortSpaces(e,t){splog("sortSpaces","spaces.js"),document.querySelectorAll(".sortbutton").forEach(e=>e.setAttribute("data-sortdir",""));var n=t?"asc":"desc";document.getElementById(e).setAttribute("data-sortdir",n);let a=document.getElementById("listcontent");n=document.querySelectorAll("#listcontent>div");Array.prototype.slice.call(n).sort(comparer(t,"data-"+e)).forEach(e=>{a.appendChild(e)}),document.dispatchEvent(new Event("spaceDeselected"))}function comparer(a,s){return splog("comparer","spaces.js"),function(e,t){var n=(a?e:t).getAttribute(s),t=(a?t:e).getAttribute(s);return e=t,""===(t=n)||""===e||isNaN(t)||isNaN(e)?t.toString().localeCompare(e):t-e}}function loadSpaces(){splog("loadSpaces","spaces.js"),getJSON({key:"spaces",url:spacefinder.spacesurl,callback:e=>{e.length&&(e.forEach((e,t)=>{spacefinder.spaces[t]=e,spacefinder.spaces[t].sortKey=e.title.replace(/[^0-9a-zA-Z]/g,"").toLowerCase()}),spacefinder.spaces.sort((e,t)=>e.sortKey<t.sortKey?-1:e.sortKey>t.sortKey?1:0),adjustSpacesForClosures(),spacefinder.spacesLoaded=!0,document.getElementById("list").dispatchEvent(new Event("spacesloaded",{bubbles:!0,cancelable:!0,composed:!1})))}})}function renderList(){splog("renderList","spaces.js");let t=document.getElementById("listcontent");var e=spacefinder.spaces.length;spacefinder.spaces.forEach(e=>{t.appendChild(getSpaceHTML(e))}),document.getElementById("searchResultsSummary").innerHTML="Showing "+e+" of "+e+" spaces"}function renderAdditionalInfo(e){var t;splog("renderAdditionalInfo","spaces.js"),document.querySelectorAll(".additionalInfo").forEach(e=>{e.replaceChildren?e.replaceChildren():e.textContent=""}),!1!==e&&(t=getSpaceById(e),getSpaceNodeById(e).querySelector(".additionalInfo").innerHTML=getAdditionalInfo(t))}function checkOpeningHours(){splog("checkOpeningHours","spaces.js");var e=new Date;let l=["sunday","monday","tuesday","wednesday","thursday","friday","saturday"][e.getDay()],c=60*e.getHours()+e.getMinutes();spacefinder.spaces.forEach((e,t)=>{let n="",a="currently-closed";var s=document.querySelector('[data-id="'+e.id+'"]').getAttribute("data-openclass");if(e.opening_hours)if(e.opening_hours[l].open){var o=getTimeFromString(e.opening_hours[l].from),i=getTimeFromString(e.opening_hours[l].to);if(o>c){let e="";var r=(o-c)%60,o=Math.floor((o-c)/60);let t="";0<o&&(t=1==o?"":"s",e+=o+"hr"+t+" "),t=1==r?"":"s",0<r&&(e+=r+"min"+t),n="Currently closed (opens in "+e+")",a="opening-later"}else if(i<c+60){let e="";o=(i-c)%60;0<o&&(e+=o+" min"+(1==o?"":"s")),n="Currently open (closes in "+e+")",a="open"}else n=i<c?(a="closed","Currently closed"):(a="open","Currently open")}else n="Closed all day";document.querySelector('[data-id="'+e.id+'"]').setAttribute("data-openmsg",n),document.querySelector('[data-id="'+e.id+'"]').setAttribute("data-openclass",a),null!=document.querySelector('[data-openmsg-id="'+e.id+'"]')&&(document.querySelector('[data-openmsg-id="'+e.id+'"]').textContent=n,document.querySelector('[data-openmsg-id="'+e.id+'"]').classList.remove(s),document.querySelector('[data-openmsg-id="'+e.id+'"]').classList.add(a))})}function adjustSpacesForClosures(){if(spacefinder.closureDates){var e=new Date,t=new Date,n=(t.setDate(e.getDate()-(e.getDay()+6)%7),["monday","tuesday","wednesday","thursday","friday","saturday","sunday"]),a=[];for(let e=0;e<7;e++){var s=new Date,s=(s.setDate(t.getDate()+e),s.getDate()+"-"+(s.getMonth()+1)+"-"+s.getFullYear());-1!==spacefinder.closureDates.indexOf(s)&&a.push(n[e])}if(a.length)for(let t=0;t<spacefinder.spaces.length;t++)a.forEach(function(e){spacefinder.spaces[t].opening_hours[e].open=!1})}}function getTimeFromString(e){e=e.split(":");return 60*parseInt(e[0])+parseInt(e[1])}function initMap(){splog("initMap","map.js"),document.addEventListener("sfmaploaded",checkGeo),document.addEventListener("filtersapplied",filterMarkers),document.addEventListener("spacesloaded",maybeSetupMap),document.addEventListener("filtersloaded",maybeSetupMap),document.addEventListener("sfmaploaded",maybeSetupMap),spacefinder.map=L.map("map").setView([spacefinder.currentLoc.lat,spacefinder.currentLoc.lng],spacefinder.startZoom),spacefinder.map.attributionControl.setPrefix('<a href="https://leafletjs.com" target="external" title="A JavaScript library for interactive maps" aria-label="Leaflet - a JavaScript library for interactive maps"><svg aria-hidden="true" xmlns="http://www.w3.org/2000/svg" width="12" height="8"><path fill="#4C7BE1" d="M0 0h12v4H0z"></path><path fill="#FFD500" d="M0 4h12v3H0z"></path><path fill="#E0BC00" d="M0 7h12v1H0z"></path></svg> Leaflet</a>'),spacefinder.osm=L.tileLayer("https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png",{maxZoom:19,attribution:'© <a target="external" href="http://www.openstreetmap.org/copyright">OpenStreetMap</a>'}).addTo(spacefinder.map),spacefinder.esri_sat=L.tileLayer("https://server.arcgisonline.com/ArcGIS/rest/services/World_Imagery/MapServer/tile/{z}/{y}/{x}",{maxZoom:19,attribution:"Tiles © Esri - Source: Esri, i-cubed, USDA, USGS, AEX, GeoEye, Getmapping, Aerogrid, IGN, IGP, UPR-EGP, and the GIS User Community"}),spacefinder.map.addControl(new L.Control.Fullscreen({position:"topright"})),spacefinder.mapLoaded=!0,spacefinder.viewdata={street:{btnText:"Street",btnLabel:"Switch to Street View",btnClass:"maptype-street",tileLayer:spacefinder.osm},satellite:{btnText:"Satellite",btnLabel:"Switch to Satellite View",btnClass:"maptype-satellite",tileLayer:spacefinder.esri_sat}},document.dispatchEvent(new Event("sfmaploaded")),document.addEventListener("click",e=>{e.target.classList.contains("show-list")&&(e.preventDefault(),document.dispatchEvent(new CustomEvent("viewchange",{bubbles:!0,cancelable:!0,composed:!1,detail:{view:"list"}}))),(e.target.classList.contains("leaflet-popup-close-button")||e.target.parentNode&&e.target.parentNode.classList&&e.target.parentNode.classList.contains("leaflet-popup-close-button"))&&e.preventDefault()}),document.addEventListener("sfresize",()=>{spacefinder.map.invalidateSize(!0)}),document.addEventListener("viewchange",()=>{splog("view changed","map.js"),window.setTimeout(()=>{splog("invalidating map size - viewchange event","map.js"),spacefinder.map.invalidateSize(!0)},500)})}function maybeSetupMap(){if(splog("maybeSetupMap","map.js"),spacefinder.mapLoaded&&spacefinder.spacesLoaded&&spacefinder.filtersLoaded){var t,n=[];spacefinder.markergroup=L.markerClusterGroup({disableClusteringAtZoom:17,zoomToBoundsOnClick:!0,spiderfyOnMaxZoom:!1,polygonOptions:{color:"#c70000",fillColor:"#c70000"}});for(let e=0;e<spacefinder.spaces.length;e++)spacefinder.spaces[e].lat&&spacefinder.spaces[e].lng&&(t=L.latLng(spacefinder.spaces[e].lat,spacefinder.spaces[e].lng),n.push([spacefinder.spaces[e].lat,spacefinder.spaces[e].lng]),spacefinder.spaces[e].marker=L.marker(t,{alt:spacefinder.spaces[e].title,title:spacefinder.spaces[e].title,icon:getSVGIcon("space-marker")}),spacefinder.markergroup.addLayer(spacefinder.spaces[e].marker),spacefinder.spaces[e].popup=L.popup().setContent(getSpaceInfoWindowContent(spacefinder.spaces[e])),spacefinder.spaces[e].popup.spaceID=spacefinder.spaces[e].id,spacefinder.spaces[e].marker.bindPopup(spacefinder.spaces[e].popup));spacefinder.map.addLayer(spacefinder.markergroup),spacefinder.map.on("popupopen",e=>{zoomMapToSpace(e.popup.spaceID),document.dispatchEvent(new CustomEvent("spaceSelectedOnMap",{bubbles:!0,detail:{id:e.popup.spaceID,src:"map"}}))}),spacefinder.map.on("popupclose",e=>{document.dispatchEvent(new CustomEvent("spaceDeselectedFromMap",{bubbles:!0,detail:{id:e.popup.spaceID}}))}),document.addEventListener("spaceSelected",e=>{zoomMapToSpace(e.detail.id)}),document.addEventListener("spaceDeselected",deselectSpacesFromMap),n.length&&spacefinder.map.fitBounds(n),spacefinder.mapBounds=spacefinder.map.getBounds(),spacefinder.mapZoom=parseInt(spacefinder.map.getZoom()),L.Control.RecentreControl=L.Control.extend({onAdd:function(e){var t=L.DomUtil.create("div","leaflet-control-recentre");return this._recentreButton=L.DomUtil.create("button","maprecentre-button icon-direction",t),this._recentreButton.innerHTML="Recentre",this._recentreButton.setAttribute("aria-label","Recentre map on my location"),this._recentreButton.setAttribute("title","Recentre map on my location"),L.DomEvent.on(this._recentreButton,"mousedown dblclick",L.DomEvent.stopPropagation).on(this._recentreButton,"click",L.DomEvent.stop).on(this._recentreButton,"click",this._recentreMap,this),t},onRemove:function(e){splog("removing recentre control","map.js"),L.DomEvent.off(this._recentreButton,"click mousedown dblclick")},_recentreMap:function(){var e=geolocationActive()?spacefinder.personLoc:spacefinder.currentLoc;spacefinder.map.panTo(e),spacefinder.recentreControl=null,this.remove()}}),L.control.recentreControl=function(e){return new L.Control.RecentreControl(e)},spacefinder.map.on("dragend",e=>{geolocationActive()&&!spacefinder.recentreControl&&(splog("adding recentre control as map was dragged by user","map.js"),spacefinder.recentreControl=L.control.recentreControl({position:"bottomleft"}).addTo(spacefinder.map))}),L.Control.MapTypeControl=L.Control.extend({onAdd:function(e){var t=spacefinder.viewdata.satellite,n=L.DomUtil.create("div","leaflet-control-maptype");this._mapTypeButton=L.DomUtil.create("button","maptype-button "+t.btnClass,n),document.createElement("button");return this._mapTypeButton.innerHTML=t.btnText,this._mapTypeButton.setAttribute("aria-label",t.btnLabel),this._mapTypeButton.setAttribute("title",t.btnLabel),this._mapTypeButton.setAttribute("data-currentType","street"),L.DomEvent.on(this._mapTypeButton,"mousedown dblclick",L.DomEvent.stopPropagation).on(this._mapTypeButton,"click",L.DomEvent.stop).on(this._mapTypeButton,"click",this._switchType,this),n},onRemove:function(e){L.DomEvent.off(this._mapTypeButton,"click mousedown dblclick")},_switchType:function(){var e=this._mapTypeButton.getAttribute("data-currentType"),t="street"==e?"satellite":"street";this._mapTypeButton.classList.replace(spacefinder.viewdata[t].btnClass,spacefinder.viewdata[e].btnClass),this._mapTypeButton.innerHTML=spacefinder.viewdata[e].btnText,this._mapTypeButton.setAttribute("aria-label",spacefinder.viewdata[e].btnLabel),this._mapTypeButton.setAttribute("title",spacefinder.viewdata[e].btnLabel),this._mapTypeButton.setAttribute("data-currentType",t),spacefinder.viewdata[e].tileLayer.removeFrom(spacefinder.map),spacefinder.viewdata[t].tileLayer.addTo(spacefinder.map)}}),L.control.mapTypeControl=function(e){return new L.Control.MapTypeControl(e)},L.control.mapTypeControl({position:"topright"}).addTo(spacefinder.map),spacefinder.mapReady=!0,document.dispatchEvent(new Event("sfmapready"))}}function getSpaceInfoWindowContent(e){var t=[],n=(t.push(e.space_type),""!==e.floor&&t.push(e.floor),""!==e.building&&t.push(e.building),'<div class="spaceInfoWindow"><h3>'+e.title+"</h3>");return n=(n+='<p class="info">'+t.join(", ")+"</p>")+('<p class="description">'+e.description+"</p>")+'<button class="show-list">More info&hellip;</button></div>'}function getSVGIcon(e){return L.divIcon({html:'<svg width="32" height="32" viewBox="0 0 32 32" version="1.1" xmlns="http://www.w3.org/2000/svg"><circle cx="16" cy="16" r="10" stroke-width="6"></circle></svg>',className:e,iconSize:[32,32],iconAnchor:[16,16]})}function recentreMap(){splog("recentreMap","map.js");var e=geolocationActive()?spacefinder.personLoc:spacefinder.currentLoc;spacefinder.map.panTo(e)}function zoomMapToSpace(e){splog("zoomMapToSpace","map.js");let t=getSpaceById(e);spacefinder.markergroup.zoomToShowLayer(t.marker,function(){var e=L.latLng(t.lat,t.lng);t.popup.setLatLng(e).openOn(spacefinder.map)})}function deselectSpacesFromMap(){splog("deselectSpacesFromMap","map.js"),spacefinder.map.closePopup()}function filterMarkers(){splog("filterMarkers","map.js");let n=[];document.querySelectorAll(".list-space").forEach(e=>{var t=getSpaceById(e.getAttribute("data-id"));e.classList.contains("hidden")||n.push(t.marker)}),spacefinder.markergroup.clearLayers(),spacefinder.markergroup.addLayers(n)}function toggleGeolocation(e){splog("toggleGeolocation","map.js"),e?document.querySelectorAll(".geo-button").forEach(e=>e.disabled=!1):document.querySelectorAll(".geo-button").forEach(e=>e.disabled=!0)}function activateGeolocation(e){splog("activateGeolocation","map.js"),e?(document.querySelectorAll(".geo-button").forEach(e=>{e.classList.add("active"),e.setAttribute("aria-label","Stop using my location"),e.setAttribute("title","Stop using my location")}),document.addEventListener("userlocationchanged",movePersonMarker),document.dispatchEvent(new CustomEvent("sfanalytics",{detail:{type:"geostart"}}))):(document.querySelectorAll(".geo-button").forEach(e=>{e.classList.remove("active"),e.setAttribute("aria-label","Use my location"),e.setAttribute("title","Use my location")}),document.removeEventListener("userlocationchanged",movePersonMarker),document.getElementById("sortdistance").setAttribute("data-sortdir",""),document.dispatchEvent(new CustomEvent("sfanalytics",{detail:{type:"geoend"}}))),updateDistances(),activateSort(e,"distance")}function movePersonMarker(){splog("movePersonMarker","map.js"),spacefinder.personMarker&&spacefinder.personMarker.setLatLng(spacefinder.personLoc),updateDistances(),null!==document.querySelector('#sortdistance[data-sortdir$="sc"')&&sortSpaces("sortdistance","desc"!=document.getElementById("sortdistance").getAttribute("data-sortdir")),spacefinder.map.panTo(spacefinder.personLoc)}function geolocationEnabled(){splog("geolocationEnabled","map.js");var e=document.querySelector(".geo-button");return null!==e&&0==e.disabled}function geolocationActive(){return splog("geolocationActive","map.js"),null!==document.querySelector(".geo-button.active")}function checkGeo(){splog("checkGeo","map.js"),checkGeoAvailable(),checkGeoPermissions()}function checkGeoPermissions(){splog("checkGeoPermissions","map.js"),"permissions"in navigator&&navigator.permissions.query&&navigator.permissions.query({name:"geolocation"}).then(e=>{spacefinder.permission=e.state,"denied"==e.state?toggleGeolocation(!1):toggleGeolocation(!0),e.onchange=function(){spacefinder.permission=e.state,"denied"==e.state?toggleGeolocation(!1):toggleGeolocation(!0)}}).catch(e=>{toggleGeolocation(!1)})}function checkGeoAvailable(){splog("checkGeoAvailable","map.js"),"geolocation"in navigator?(L.Control.geoControl=L.Control.extend({onAdd:function(e){var t=L.DomUtil.create("div","leaflet-control-geolocation"),n=document.createElement("button");return n.innerHTML="",n.classList.add("geo-button"),n.classList.add("icon-my-location"),n.setAttribute("aria-label","Use my location"),n.setAttribute("title","Use my location"),t.appendChild(n),t},onRemove:function(e){}}),L.control.geoControl=function(e){return new L.Control.geoControl(e)},L.control.geoControl({position:"topright"}).addTo(spacefinder.map),document.addEventListener("click",e=>{e.target.matches(".geo-button")&&geolocationEnabled()&&(geolocationActive()?forgetUserPosition:getUserPosition)()})):(activateGeolocation(!1),toggleGeolocation(!1))}function forgetUserPosition(){splog("forgetUserPosition","map.js"),navigator.geolocation.clearWatch(spacefinder.watchID),spacefinder.personMarker.remove(),spacefinder.recentreControl&&(spacefinder.recentreControl.remove(),spacefinder.recentreControl=null),activateGeolocation(!1),spacefinder.map.panTo(spacefinder.currentLoc)}function getUserPosition(){splog("getUserPosition","map.js"),navigator.geolocation.getCurrentPosition(e=>{spacefinder.personLoc.lat=e.coords.latitude,spacefinder.personLoc.lng=e.coords.longitude,spacefinder.mapBounds.contains(spacefinder.personLoc)?(spacefinder.map.panTo(spacefinder.personLoc),spacefinder.personMarker=L.marker(spacefinder.personLoc,{alt:"Your location",title:"Your location",icon:getSVGIcon("person-marker")}).addTo(spacefinder.map),activateGeolocation(!0),spacefinder.watchID=navigator.geolocation.watchPosition(e=>{spacefinder.personLoc.lat==e.coords.latitude&&spacefinder.personLoc.lng==e.coords.longitude||(spacefinder.personLoc.lat=e.coords.latitude,spacefinder.personLoc.lng=e.coords.longitude,document.dispatchEvent(new Event("userlocationchanged")))},e=>{navigator.geolocation.clearWatch(spacefinder.watchID),activateGeolocation(!1)})):(toggleGeolocation(!1),openAlertDialog("Sorry...","You need to be a bit nearer to use this feature."))},e=>{switch(activateGeolocation(!1),e.code){case 1:case 2:toggleGeolocation(!1)}})}function updateDistances(){var e;splog("updateDistances","map.js"),geolocationActive()?spacefinder.spaces.forEach((e,t)=>{var n=haversine_distance(spacefinder.personLoc,{lat:e.lat,lng:e.lng}),n=(document.querySelector('[data-id="'+e.id+'"]').setAttribute("data-sortdistance",n),1e3<n?(n/1e3).toFixed(2)+"km  away":1<n?n+" metres away":1===n?n+" metre away":"You are here!");document.getElementById("distance"+e.id).innerHTML=n}):null!==(e=document.querySelectorAll(".list-space"))&&e.forEach(e=>e.setAttribute("data-sortdistance",""))}function checkInitialPageLoad(){document.addEventListener("sfmapready",e=>{var t,n;window.location.hash&&3===(n=window.location.hash.split("/")).length&&("space"==n[1]&&(t=getSpaceBySlug(n[2]),document.dispatchEvent(new CustomEvent("spaceSelected",{bubbles:!0,detail:{id:t.id,src:"load"}})),setElementFocus("space"+t.id)),"page"==n[1])&&null!==(t=document.getElementById(n[2]+"-page"))&&((n=new A11yDialog(t)).show(),n.on("hide",(e,t)=>{setHash("")}))})}document.addEventListener("DOMContentLoaded",()=>{setupLayout(),document.addEventListener("spacesloaded",setView),document.addEventListener("sfmapready",setView),document.addEventListener("filtersloaded",setView),document.addEventListener("sfresize",setView),window.addEventListener("resize",()=>{clearTimeout(spacefinder.resizeTimeout),spacefinder.resizeTimeout=setTimeout(()=>{splog("Resize event","layout.js"),document.dispatchEvent(new Event("sfresize"))},200)})}),document.addEventListener("spacesloaded",()=>{document.addEventListener("filtersloaded",()=>{renderFilters(),setupFilters()}),loadFilters()}),document.addEventListener("DOMContentLoaded",()=>{document.addEventListener("spacesloaded",()=>{renderList(),updateDistances(),checkOpeningHours(),setInterval(checkOpeningHours,3e4),activateSort(!0,"alpha")}),loadSpaces(),document.addEventListener("viewfilter",applyFilters),document.addEventListener("filtersapplied",updateListFilterMessage),document.addEventListener("spaceSelected",e=>{selectSpace(e.detail.id,e.detail.src)}),document.addEventListener("spaceDeselected",e=>{deselectSpaces(e.detail)}),document.addEventListener("spaceSelectedOnMap",e=>{selectSpace(e.detail.id,"map")}),document.addEventListener("spaceDeselectedFromMap",e=>{deselectSpaces(e.detail)}),document.addEventListener("click",e=>{if(e.target.classList.contains("show-map"))e.preventDefault(),document.dispatchEvent(new CustomEvent("viewchange",{bubbles:!0,cancelable:!0,composed:!1,detail:{view:"map"}}));else if(e.target.classList.contains("load-info"))e.preventDefault(),"true"===e.target.getAttribute("aria-expanded")?(a=e.target.getAttribute("data-spaceid"),document.dispatchEvent(new CustomEvent("spaceDeselected",{bubbles:!0,detail:a})),e.target.setAttribute("aria-expanded","false"),setHash("")):(a=e.target.getAttribute("data-spaceid"),document.querySelector('[data-id="'+a+'"]').classList.contains("active")||document.dispatchEvent(new CustomEvent("spaceSelected",{bubbles:!0,detail:{id:a,src:"list"}})),e.target.setAttribute("aria-expanded","true"));else if(e.target.classList.contains("search-term")){e.preventDefault();let t=e.target.getAttribute("data-searchtext");var a=document.getElementById("search-input").value.trim().split(" ");let n=[];a.forEach(e=>{e!=t&&n.push(e)}),document.getElementById("search-input").value=n.join(" "),document.dispatchEvent(new Event("viewfilter",{bubbles:!0}))}else e.target.classList.contains("filter-term")&&(e.preventDefault(),a=e.target.getAttribute("data-termid"),document.getElementById(a).checked=!1,document.dispatchEvent(new Event("viewfilter",{bubbles:!0})))})}),document.addEventListener("DOMContentLoaded",()=>{initMap()}),function(e){if("function"==typeof define&&define.amd)define(["leaflet"],e);else if("undefined"!=typeof module)module.exports=e(require("leaflet"));else{if(void 0===window.L)throw new Error("Leaflet must be loaded first");e(window.L)}}(function(n){n.Control.Fullscreen=n.Control.extend({options:{position:"topleft",title:{false:"View Fullscreen",true:"Exit Fullscreen"}},onAdd:function(e){var t=n.DomUtil.create("div","leaflet-control-fullscreen");return this.fsbutton=document.createElement("button"),this.fsbutton.innerHTML='<span class="visuallyhidden"></span>',this.fsbutton.classList.add("mapfullscreen-button"),this.fsbutton.classList.add("icon-resize-full"),t.appendChild(this.fsbutton),this._map=e,this._map.on("fullscreenchange",this._toggleTitle,this),this._toggleTitle(),n.DomEvent.on(this.fsbutton,"click",this._click,this),t},_click:function(e){n.DomEvent.stopPropagation(e),n.DomEvent.preventDefault(e),this._map.toggleFullscreen(this.options)},_toggleTitle:function(){this._map.isFullscreen()?(this.fsbutton.classList.remove("icon-resize-full"),this.fsbutton.classList.add("icon-resize-small")):(this.fsbutton.classList.remove("icon-resize-small"),this.fsbutton.classList.add("icon-resize-full")),this.fsbutton.setAttribute("aria-label",this.options.title[this._map.isFullscreen()]),this.fsbutton.setAttribute("title",this.options.title[this._map.isFullscreen()]),this.fsbutton.querySelector("span").innerText=this.options.title[this._map.isFullscreen()]}}),n.Map.include({isFullscreen:function(){return this._isFullscreen||!1},toggleFullscreen:function(e){var t=this.getContainer();this.isFullscreen()?e&&e.pseudoFullscreen?this._disablePseudoFullscreen(t):document.exitFullscreen?document.exitFullscreen():document.mozCancelFullScreen?document.mozCancelFullScreen():document.webkitCancelFullScreen?document.webkitCancelFullScreen():document.msExitFullscreen?document.msExitFullscreen():this._disablePseudoFullscreen(t):e&&e.pseudoFullscreen?this._enablePseudoFullscreen(t):t.requestFullscreen?t.requestFullscreen():t.mozRequestFullScreen?t.mozRequestFullScreen():t.webkitRequestFullscreen?t.webkitRequestFullscreen(Element.ALLOW_KEYBOARD_INPUT):t.msRequestFullscreen?t.msRequestFullscreen():this._enablePseudoFullscreen(t)},_enablePseudoFullscreen:function(e){n.DomUtil.addClass(e,"leaflet-pseudo-fullscreen"),this._setFullscreen(!0),this.fire("fullscreenchange")},_disablePseudoFullscreen:function(e){n.DomUtil.removeClass(e,"leaflet-pseudo-fullscreen"),this._setFullscreen(!1),this.fire("fullscreenchange")},_setFullscreen:function(e){this._isFullscreen=e;var t=this.getContainer();e?n.DomUtil.addClass(t,"leaflet-fullscreen-on"):n.DomUtil.removeClass(t,"leaflet-fullscreen-on"),this.invalidateSize()},_onFullscreenChange:function(e){var t=document.fullscreenElement||document.mozFullScreenElement||document.webkitFullscreenElement||document.msFullscreenElement;t!==this.getContainer()||this._isFullscreen?t!==this.getContainer()&&this._isFullscreen&&(this._setFullscreen(!1),this.fire("fullscreenchange")):(this._setFullscreen(!0),this.fire("fullscreenchange"))}}),n.Map.mergeOptions({fullscreenControl:!1}),n.Map.addInitHook(function(){var e,t;this.options.fullscreenControl&&(this.fullscreenControl=new n.Control.Fullscreen(this.options.fullscreenControl),this.addControl(this.fullscreenControl)),"onfullscreenchange"in document?e="fullscreenchange":"onmozfullscreenchange"in document?e="mozfullscreenchange":"onwebkitfullscreenchange"in document?e="webkitfullscreenchange":"onmsfullscreenchange"in document&&(e="MSFullscreenChange"),e&&(t=n.bind(this._onFullscreenChange,this),this.whenReady(function(){n.DomEvent.on(document,e,t)}),this.on("unload",function(){n.DomEvent.off(document,e,t)}))}),n.control.fullscreen=function(e){return new n.Control.Fullscreen(e)}}),document.addEventListener("DOMContentLoaded",()=>{checkInitialPageLoad()}),document.addEventListener("DOMContentLoaded",()=>{document.addEventListener("sfanalytics",e=>{"function"==typeof gtag&&("search"==e.detail.type?gtag("event","search",{search_term:e.detail.terms}):"filter"==e.detail.type?gtag("event","select_content",{content_type:e.detail.filtername,item_id:e.detail.terms}):"geostart"==e.detail.type?gtag("event","level_start",{level_name:"Geolocation activated"}):"geoend"==e.detail.type?gtag("event","level_end",{level_name:"Geolocation deactivated"}):"select"==e.detail.type&&gtag("event","select_item",{item_list_id:e.detail.src,item_list_name:e.detail.src,items:[{item_id:e.detail.id,item_name:e.detail.name}]}))})});"use strict";class Accordion{constructor(e){this.rootEl=e,this.buttonEl=this.rootEl.querySelector("button[aria-expanded]");e=this.buttonEl.getAttribute("aria-controls");this.contentEl=document.getElementById(e),this.open="true"===this.buttonEl.getAttribute("aria-expanded"),this.buttonEl.addEventListener("click",this.onButtonClick.bind(this))}onButtonClick(e){e.preventDefault(),this.toggle(!this.open)}toggle(e){e!==this.open&&(this.open=e,this.buttonEl.setAttribute("aria-expanded",e?"true":"false"),e?this.contentEl.removeAttribute("hidden"):this.contentEl.setAttribute("hidden",""))}open(){this.toggle(!0)}close(){this.toggle(!1)}}function openAlertDialog(e,t){document.getElementById("sfalertdialog-title").textContent=e,document.getElementById("sfalertdialog-description").innerHTML=t;e=new A11yDialog(document.getElementById("sfalertdialog"));e.show(),e.on("hide",(e,t)=>{document.getElementById("sfalertdialog-title").textContent="Dialog title",document.getElementById("sfalertdialog-description").textContent="Dialog description"})}document.addEventListener("DOMContentLoaded",()=>{document.querySelectorAll(".modal-trigger").forEach(e=>{var t=e.getAttribute("data-dialogid");let n=e.getAttribute("data-dialoghash"),a=new A11yDialog(document.getElementById(t));e.addEventListener("click",e=>{a.show(),a.originalpagehash=window.location.hash,window.location.hash="#/page/"+n,document.dispatchEvent(new CustomEvent("sfanalytics",{detail:{type:"select",id:n,name:e.target.textContent}}))}),a.on("hide",(e,t)=>{window.location.hash=a.originalpagehash})})});